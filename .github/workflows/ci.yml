name: BuildAndTest

on:
  push:
    paths-ignore:
      - 'README.md'
      - '.gitignore'
      - 'asset/**'
      - 'LICENSE'


jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-20.04, windows-2019]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v2
      - name: install tools
        run: sudo apt install gcc-10 && export CXX=$(which g++-10)
        if: ${{ startsWith(matrix.os, 'ubuntu') }}
      - name: install deps
        run: vcpkg install gtest
      - name: get vcpkg root
        run: export VCPKG_ROOT=$(which vcpkg) && echo $VCPKG_ROOT
        if: ${{ startsWith(matrix.os, 'ubuntu') }}
      - name: get vcpkg root
        run: set VCPKG_ROOT $(Get-Command vcpkg | Select-Object -ExpandProperty Definition); echo $VCPKG_ROOT
        if: ${{ startsWith(matrix.os, 'windows') }}
      - name: generate build script
        run: cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake .
      - name: build project
        run: cmake --build .
      - name: run unit testing
        run: ctest

