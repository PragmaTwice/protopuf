name: BuildAndTest

on:
  push:
    paths-ignore:
      - 'README.md'
      - '.gitignore'
      - 'asset/**'
      - 'LICENSE'

jobs:
  build:
    strategy:
      matrix:
        - runs-on: ubuntu-20.04
          steps:
            - uses: actions/checkout@v2
            - name: install deps
              run: sudo apt install gcc-10 libgtest-dev
            - name: generate build script
              run: CXX=/usr/bin/g++-10 cmake -DCMAKE_BUILD_TYPE=Release .
            - name: build project
              run: cmake --build .
            - name: run unit testing
              run: ctest
        - runs-on: windows-2019
          steps:
            - uses: actions/checkout@v2
            - name: install deps
              run: vcpkg install gtest
            - name: generate build script
              run: cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=${{ env.VCPKG_DEST_WIN }}/scripts/buildsystems/vcpkg.cmake .
            - name: build project
              run: cmake --build .
            - name: run unit testing
              run: ctest 
